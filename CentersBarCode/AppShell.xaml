<?xml version="1.0" encoding="UTF-8" ?>
<Shell
    x:Class="CentersBarCode.AppShell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:CentersBarCode.Converters"
    xmlns:local="clr-namespace:CentersBarCode"
    xmlns:views="clr-namespace:CentersBarCode.Views"
    xmlns:vm="clr-namespace:CentersBarCode.ViewModels"
    x:DataType="vm:AppShellViewModel"
    FlyoutBackgroundColor="Transparent"
    FlyoutBehavior="{Binding ShowFlyoutItems, Converter={x:Static converters:BoolToFlyoutBehaviorConverter.Instance}}"
    FlyoutIcon="menu_icon.png"
    Shell.BackgroundColor="Gray">

    <!--  Custom Flyout Content with modern translucent design  -->
    <Shell.FlyoutContent>
        <Grid>
            <!--  Background with blur effect  -->
            <Frame
                Padding="0"
                BackgroundColor="#F8F9FA"
                CornerRadius="0"
                HasShadow="False">
                <Frame.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Offset="0.0" Color="#F8F9FA" />
                        <GradientStop Offset="1.0" Color="#E9ECEF" />
                    </LinearGradientBrush>
                </Frame.Background>
            </Frame>

            <!--  Main Content  -->
            <ScrollView>
                <StackLayout
                    HorizontalOptions="Fill"
                    Spacing="0"
                    VerticalOptions="Fill">
                    <!--  Header Section  -->
                    <Grid
                        Padding="20,40,20,20"
                        BackgroundColor="Transparent"
                        HeightRequest="180"
                        IsVisible="{Binding IsAuthenticated}">
                        <Grid.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Offset="0.0" Color="#667EEA" />
                                <GradientStop Offset="1.0" Color="#764BA2" />
                            </LinearGradientBrush>
                        </Grid.Background>

                        <StackLayout VerticalOptions="Center">
                            <!--  App Title with modern typography  -->
                            <Label
                                Margin="0,0,0,8"
                                FontAttributes="Bold"
                                FontSize="22"
                                Text="Centers Barcode"
                                TextColor="White" />

                            <!--  User Email with subtle styling  -->
                            <Label
                                Margin="0,0,0,12"
                                FontSize="14"
                                Text="{Binding UserEmail}"
                                TextColor="#E8E8E8" />

                            <!--  Records, Students, and Centers Badges  -->
                            <StackLayout HorizontalOptions="Center">
                                <!--  First Row  -->
                                <!--  Teacher Name  -->
                                <Frame
                                    Padding="8,4"
                                    BackgroundColor="Transparent"
                                    BorderColor="Transparent"
                                    CornerRadius="12"
                                    HasShadow="False"
                                    IsVisible="True">
                                    <StackLayout HorizontalOptions="Center" Orientation="Horizontal">
                                        <Label
                                            FontAttributes="Bold"
                                            FontSize="14"
                                            HorizontalTextAlignment="Center"
                                            Text="{Binding TeacherName}"
                                            TextColor="#FFFFFF" />
                                    </StackLayout>
                                </Frame>

                                <!--  Second Row  -->
                                <StackLayout
                                    HorizontalOptions="Center"
                                    Orientation="Horizontal"
                                    Spacing="2">
                                    <!--  Centers Badge  -->
                                    <Frame
                                        Padding="8,4"
                                        BackgroundColor="#6F42C1"
                                        CornerRadius="12"
                                        HasShadow="False"
                                        IsVisible="{Binding HasCentersBadge}">
                                        <StackLayout Orientation="Horizontal" Spacing="4">
                                            <Label
                                                FontSize="8"
                                                Text="🏢"
                                                TextColor="White"
                                                VerticalOptions="Center" />
                                            <Label
                                                FontAttributes="Bold"
                                                FontSize="8"
                                                Text="{Binding CentersCount, StringFormat='{0} Centers'}"
                                                TextColor="White"
                                                VerticalOptions="Center" />
                                        </StackLayout>
                                    </Frame>

                                    <!--  Records Badge  -->
                                    <Frame
                                        Padding="8,4"
                                        BackgroundColor="#FFD700"
                                        CornerRadius="12"
                                        HasShadow="False"
                                        IsVisible="{Binding HasBadge}">
                                        <StackLayout Orientation="Horizontal" Spacing="4">
                                            <Label
                                                FontSize="8"
                                                Text="📋"
                                                VerticalOptions="Center" />
                                            <Label
                                                FontAttributes="Bold"
                                                FontSize="8"
                                                Text="{Binding RecordsCount, StringFormat='{0} Records'}"
                                                TextColor="#1A1A1A"
                                                VerticalOptions="Center" />
                                        </StackLayout>
                                    </Frame>

                                    <!--  Students Badge  -->
                                    <Frame
                                        Padding="8,4"
                                        BackgroundColor="#28A745"
                                        CornerRadius="12"
                                        HasShadow="False"
                                        IsVisible="{Binding HasStudentsBadge}">
                                        <StackLayout Orientation="Horizontal" Spacing="4">
                                            <Label
                                                FontSize="8"
                                                Text="👥"
                                                TextColor="White"
                                                VerticalOptions="Center" />
                                            <Label
                                                FontAttributes="Bold"
                                                FontSize="8"
                                                Text="{Binding StudentsCount, StringFormat='{0} Students'}"
                                                TextColor="White"
                                                VerticalOptions="Center" />
                                        </StackLayout>
                                    </Frame>

                                </StackLayout>
                            </StackLayout>
                        </StackLayout>
                    </Grid>

                    <!--  Navigation Items  -->
                    <StackLayout Padding="16,20,16,20" Spacing="8">

                        <!--  Login Item (when not authenticated)  -->
                        <Button
                            BackgroundColor="#F8F9FA"
                            BorderColor="#DEE2E6"
                            BorderWidth="1"
                            Clicked="OnLoginClicked"
                            CornerRadius="12"
                            FontAttributes="Bold"
                            FontSize="16"
                            HeightRequest="50"
                            IsVisible="{Binding IsAuthenticated, Converter={x:Static converters:InverseBoolConverter.Instance}}"
                            Text="🔐 Login"
                            TextColor="#495057" />

                        <!--  Main Menu Items (when authenticated)  -->
                        <StackLayout IsVisible="{Binding IsAuthenticated}" Spacing="8">

                            <!--  Main Page  -->
                            <Button
                                BackgroundColor="White"
                                BorderColor="#E9ECEF"
                                BorderWidth="1"
                                Clicked="OnMainClicked"
                                Command="{Binding NavigateToMainCommand}"
                                CornerRadius="12"
                                FontAttributes="Bold"
                                FontSize="16"
                                HeightRequest="50"
                                Text="🏠 Main"
                                TextColor="#343A40" />

                            <!--  Attach Card Page  -->
                            <Button
                                BackgroundColor="White"
                                BorderColor="#E9ECEF"
                                BorderWidth="1"
                                Clicked="OnAttachCardClicked"
                                Command="{Binding NavigateToAttachCardCommand}"
                                CornerRadius="12"
                                FontAttributes="Bold"
                                FontSize="16"
                                HeightRequest="50"
                                Text="📱 Attach Card"
                                TextColor="#343A40" />

                            <!--  Manual Attendance Page - NEW  -->
                            <Button
                                BackgroundColor="White"
                                BorderColor="#E9ECEF"
                                BorderWidth="1"
                                Clicked="OnManualAddClicked"
                                Command="{Binding NavigateToManualAddCommand}"
                                CornerRadius="12"
                                FontAttributes="Bold"
                                FontSize="16"
                                HeightRequest="50"
                                Text="✏️ Manual Attendance"
                                TextColor="#343A40" />

                            <!--  Records Page  -->
                            <Button
                                BackgroundColor="White"
                                BorderColor="#E9ECEF"
                                BorderWidth="1"
                                Clicked="OnRecordsClicked"
                                Command="{Binding NavigateToRecordsCommand}"
                                CornerRadius="12"
                                FontAttributes="Bold"
                                FontSize="16"
                                HeightRequest="50"
                                Text="📄 Records"
                                TextColor="#343A40" />

                            <!--  Import Centers Button  -->
                            <Button
                              BackgroundColor="#6F42C1"
                              BorderColor="#5A2D91"
                              BorderWidth="1"
                              Command="{Binding AutoImportDataCommand}"
                              CornerRadius="12"
                              FontAttributes="Bold"
                              FontSize="16"
                              HeightRequest="50"
                              ImageSource="import_icon.png"
                              IsEnabled="{Binding IsAutoImporting, Converter={x:Static converters:InverseBoolConverter.Instance}}"
                              Text="Import Data"
                              TextColor="White" />

                            <!--  Import Students Button  -->
                            <Button
                              BackgroundColor="#28A745"
                              BorderColor="#1E7E34"
                              BorderWidth="1"
                              Command="{Binding AutoExportDataCommand}"
                              CornerRadius="12"
                              FontAttributes="Bold"
                              FontSize="16"
                              HeightRequest="50"
                              ImageSource="export_icon.png"
                              IsEnabled="{Binding IsAutoExporting, Converter={x:Static converters:InverseBoolConverter.Instance}}"
                              Text="Export Data"
                              TextColor="White" />          




                        </StackLayout>
                    </StackLayout>
                    <!--  Logout Button  -->
                    <!--  Import Status Indicators  -->
                    <StackLayout
                        HorizontalOptions="Center"
                        Spacing="4"
                        VerticalOptions="Center">
                        <!--  Centers Import Status  -->
                        <StackLayout
                           Padding="12,4"
                           IsVisible="{Binding IsAutoImporting}"
                           Orientation="Horizontal"
                           Spacing="8">
                                                <ActivityIndicator
                               HeightRequest="20"
                               IsRunning="{Binding IsAutoImporting}"
                               WidthRequest="20"
                               Color="#6F42C1" />
                                                <Label
                               FontSize="14"
                               Text="Importing data..."
                               TextColor="#6C757D"
                               VerticalOptions="Center" />
                         </StackLayout>

                                            <!--  Students Import Status  -->
                        <StackLayout
                           Padding="12,4"
                           IsVisible="{Binding IsAutoExporting}"
                           Orientation="Horizontal"
                           Spacing="8">
                                                <ActivityIndicator
                               HeightRequest="20"
                               IsRunning="{Binding IsAutoExporting}"
                               WidthRequest="20"
                               Color="#28A745" />
                                            <Label
                               FontSize="14"
                               Text="Exporting data..."
                               TextColor="#6C757D"
                               VerticalOptions="Center" />          
                        </StackLayout>
                    </StackLayout>
                </StackLayout>
            </ScrollView>
            <Button
                Margin="20"
                BackgroundColor="#FFF5F5"
                BorderColor="#F5C6CB"
                BorderWidth="1"
                Command="{Binding LogoutCommand}"
                CornerRadius="12"
                FontAttributes="Bold"
                FontSize="16"
                HeightRequest="50"
                Text="🚪 Logout"
                TextColor="#DC3545"
                VerticalOptions="End" />
        </Grid>
    </Shell.FlyoutContent>

    <!--  Shell Items for routing - All pages visible but hidden from flyout via custom content  -->
    <FlyoutItem
        Title="Login"
        IsVisible="{Binding IsAuthenticated, Converter={x:Static converters:InverseBoolConverter.Instance}}"
        Route="LoginPage">
        <ShellContent Title="Login" ContentTemplate="{DataTemplate views:LoginPage}" />
    </FlyoutItem>

    <FlyoutItem
        Title="Main"
        IsVisible="{Binding IsAuthenticated}"
        Route="MainPage">
        <ShellContent Title="Main" ContentTemplate="{DataTemplate views:MainPage}" />
    </FlyoutItem>

    <FlyoutItem
        Title="Attach Card"
        IsVisible="{Binding IsAuthenticated}"
        Route="AttachCardPage">
        <ShellContent Title="Attach Card" ContentTemplate="{DataTemplate views:AttachCardPage}" />
    </FlyoutItem>
    
    <FlyoutItem
        Title="Manual Attendance"
        IsVisible="{Binding IsAuthenticated}"
        Route="ManualAddPage">
        <ShellContent Title="Manual Attendance" ContentTemplate="{DataTemplate views:ManualAddPage}" />
    </FlyoutItem>

    <FlyoutItem
        Title="Records"
        IsVisible="{Binding IsAuthenticated}"
        Route="RecordsPage">
        <ShellContent Title="Records" ContentTemplate="{DataTemplate views:RecordsPage}" />
    </FlyoutItem>
</Shell>