<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="CentersBarCode.Views.QrScanner"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:barcode="clr-namespace:BarcodeScanning;assembly=BarcodeScanning.Native.Maui"
    Title="QrScanner"
    x:Name="ScannerPage">
    <Grid
        x:Name="qrScannerGrid"
        Grid.Row="0"
        Grid.RowSpan="3"
        BackgroundColor="Black"
        IsVisible="{Binding IsQrScannerVisible}"
        RowDefinitions="Auto,*,*,*">

        <barcode:CameraView
            x:Name="cameraView"
            Grid.Row="2"
            CameraEnabled ="True"
            OnDetectionFinished="CameraView_BarCodeDetected"
            CameraFacing="Back"
            HeightRequest="150"
            HorizontalOptions="Fill"
            VerticalOptions="Fill"
            WidthRequest="300" />

        <StackLayout
            Grid.Row="2"
            Margin="0,-30,0,0"
            HorizontalOptions="Center"
            Orientation="Horizontal"
            VerticalOptions="Start">
            <Label
                Grid.Row="1"
                Grid.Column="0"
                Margin="0,0,0,0"
                FontSize="14"
                HorizontalOptions="Center"
                Text="Position Barcode inside frame"
                TextColor="White" />

            <Button
                Grid.Row="1"
                Margin="0,-10,0,0"
                Padding="0"
                BackgroundColor="Transparent"
                BorderColor="Transparent"
                Clicked="ToggleFlash_Clicked"
                FontSize="24"
                HeightRequest="40"
                HorizontalOptions="Center"
                Text="ðŸ’¡"
                WidthRequest="40" />
        </StackLayout>
        <Grid
            Grid.Row="2"
            ColumnDefinitions="*,Auto"
            HorizontalOptions="Center"
            RowSpacing="10"
            VerticalOptions="Center">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Frame
                Grid.Row="1"
                Grid.Column="0"
                Padding="2"
                BackgroundColor="Transparent"
                BorderColor="White"
                CornerRadius="10"
                HasShadow="False"
                HeightRequest="150"
                HorizontalOptions="Center"
                WidthRequest="250" />
        </Grid>
        <!--  Controls Grid  -->
        <Grid
            Grid.Row="0"
            Padding="20"
            RowDefinitions="Auto,*,Auto">
            <!--  Top controls  -->
            <VerticalStackLayout
                Grid.Row="0"
                HorizontalOptions="Center"
                Spacing="10">
                <!-- Auto Scan Counter -->
                <Frame 
                    x:Name="autoScanFrame"
                    IsVisible="{Binding IsAutoScanMode}"
                    BackgroundColor="#1E90FF"
                    CornerRadius="10"
                    Padding="15,8"
                    HorizontalOptions="Center"
                    Margin="0,0,0,10">
                    <StackLayout Orientation="Horizontal" Spacing="10">
                        <Label 
                            Text="AUTO SCAN MODE" 
                            TextColor="White" 
                            FontAttributes="Bold" 
                            VerticalOptions="Center"/>
                        <Label
                            Text="|"
                            TextColor="White"
                            VerticalOptions="Center"/>
                        <Label 
                            Text="{Binding ScanCount, Source={x:Reference ScannerPage}}" 
                            TextColor="White" 
                            FontSize="18"
                            FontAttributes="Bold"
                            VerticalOptions="Center"/>
                    </StackLayout>
                </Frame>

                <Label
                    BackgroundColor="Transparent"
                    FontSize="24"
                    HorizontalTextAlignment="Center"
                    Text="{Binding TeacherName}"
                    TextColor="#FFFFFF" />
                <Label
                  BackgroundColor="Transparent"
                  FontSize="24"
                  HorizontalTextAlignment="Center"
                  IsVisible="{Binding SelectedCenter}"
                  Text="{Binding SelectedCenter}"
                  TextColor="#FFFFFF" />        
                <Label
                    BackgroundColor="Transparent"
                    FontSize="20"
                    HorizontalTextAlignment="Center"
                    IsVisible="{Binding PhoneNumber}"
                    Text="{Binding PhoneNumber}"
                    TextColor="#FFFFFF" />
                <Label
                     BackgroundColor="Transparent"
                     FontSize="20"
                     HorizontalTextAlignment="Center"
                     IsVisible="{Binding StudentName}"
                     Text="{Binding StudentName}"
                     TextColor="#FFFFFF" />

            </VerticalStackLayout>
        </Grid>
        <!--  Controls Grid  -->
        <Grid
            Grid.Row="3"
            Padding="20"
            RowDefinitions="Auto,*,Auto">
            <!--  Bottom controls  -->
            <VerticalStackLayout
                Grid.Row="2"
                HorizontalOptions="Center"
                Spacing="10">
                <!-- Last Scanned Item -->
                <Label
                    x:Name="lastScannedLabel"
                    IsVisible="{Binding IsAutoScanMode}"
                    Text="{Binding ScannedCode, StringFormat='Last Scanned: {0}'}"
                    TextColor="#90EE90"
                    FontSize="18"
                    HorizontalOptions="Center"
                    Margin="0,0,0,10"/>

                <Button
                    BackgroundColor="Red"
                    Clicked="CloseQr"
                    Command="{Binding CloseQrScannerCommand}"
                    HorizontalOptions="Center"
                    Text="Close Scanner"
                    TextColor="White" />
            </VerticalStackLayout>
        </Grid>
    </Grid>
</ContentPage>