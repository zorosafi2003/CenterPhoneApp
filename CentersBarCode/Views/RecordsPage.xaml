<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="CentersBarCode.Views.RecordsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:CentersBarCode.ViewModels"
    xmlns:vm="clr-namespace:CentersBarCode.ViewModels"
    Title="{Binding Title}"
    x:DataType="vm:RecordsViewModel"
    Shell.BackgroundColor="Gray">


            <Grid Padding="10" RowDefinitions="Auto,*">
                <!--  Header  -->
                <StackLayout Grid.Row="0" Padding="10,0">

                    <!--  Records count  -->
                    <Label
                        Margin="0,0,0,20"
                        FontSize="16"
                        HorizontalOptions="Center"
                        Text="{Binding RecordsCount, StringFormat='Total Records: {0}'}" />
                </StackLayout>

                <!--  Records Table  -->
                <Grid Grid.Row="1" IsVisible="{Binding HasRecords}">
                    <CollectionView BackgroundColor="Transparent" ItemsSource="{Binding Records}">
                        <CollectionView.Header>
                            <!--  Table Header  -->
                            <Grid Padding="10,5" BackgroundColor="LightGray">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <Label
                                    Grid.Column="0"
                                    FontAttributes="Bold"
                                    Text="Code / Name"
                                    VerticalOptions="Center" />
                                <Label
                                    Grid.Column="1"
                                    FontAttributes="Bold"
                                    Text="Date"
                                    VerticalOptions="Center" />
                                <Label
                                    Grid.Column="2"
                                    FontAttributes="Bold"
                                    Text="Actions"
                                    VerticalOptions="Center" />
                            </Grid>
                        </CollectionView.Header>

                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="local:QrCodeRecordDisplay">
                                <Grid Padding="10,8" BackgroundColor="White">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!--  Add separator line  -->
                                    <BoxView
                                        Grid.Row="0"
                                        Grid.ColumnSpan="3"
                                        BackgroundColor="LightGray"
                                        HeightRequest="1"
                                        HorizontalOptions="FillAndExpand"
                                        VerticalOptions="Start" />

                                    <!--  First Row: Code and Date  -->
                                    <Label
                                        Grid.Row="0"
                                        Grid.Column="0"
                                        Margin="0,5,0,2"
                                        FontSize="14"
                                        FontAttributes="Bold"
                                        LineBreakMode="TailTruncation"
                                        Text="{Binding Code}"
                                        VerticalOptions="Center" />

                                    <Label
                                        Grid.Row="0"
                                        Grid.Column="1"
                                        Margin="0,5,0,2"
                                        FontSize="12"
                                        Text="{Binding Date, StringFormat='{0}'}"
                                        VerticalOptions="Center" />

                                    <!--  Delete Button  -->
                                    <Button
                                        Grid.Row="0"
                                        Grid.Column="2"
                                        Grid.RowSpan="2"
                                        BackgroundColor="Red"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:RecordsViewModel}}, Path=DeleteRecordCommand}"
                                        CommandParameter="{Binding .}"
                                        Text="Delete"
                                        TextColor="White"
                                        FontSize="12"
                                        HeightRequest="40"
                                        WidthRequest="70"
                                        CornerRadius="5"
                                        VerticalOptions="Center" />

                                    <!--  Second Row: Name  -->
                                    <Label
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        Grid.ColumnSpan="2"
                                        Margin="0,2,0,5"
                                        FontSize="13"
                                        FontAttributes="Italic"
                                        LineBreakMode="TailTruncation"
                                        Text="{Binding Name}"
                                        TextColor="Gray"
                                        VerticalOptions="Center" />

                                </Grid>
                                
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </Grid>

                <!--  No Records Message  -->
                <StackLayout
                    Grid.Row="1"
                    HorizontalOptions="CenterAndExpand"
                    IsVisible="{Binding HasNoRecords}"
                    VerticalOptions="CenterAndExpand">

                    <Label
                        FontSize="18"
                        HorizontalOptions="Center"
                        Text="No records found"
                        TextColor="Gray" />

                    <Label
                        Margin="0,10,0,0"
                        FontSize="14"
                        HorizontalOptions="Center"
                        Text="Scan some QR codes to see them here!"
                        TextColor="Gray" />
                </StackLayout>

                <!--  Loading Indicator  -->
                <ActivityIndicator
                    Grid.Row="1"
                    HorizontalOptions="CenterAndExpand"
                    IsRunning="{Binding IsLoading}"
                    IsVisible="{Binding IsLoading}"
                    VerticalOptions="CenterAndExpand"
                    Color="Blue" />
            </Grid>

</ContentPage>