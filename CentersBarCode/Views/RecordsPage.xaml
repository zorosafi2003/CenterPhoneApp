<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="CentersBarCode.Views.RecordsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:CentersBarCode.ViewModels"
    xmlns:vm="clr-namespace:CentersBarCode.ViewModels"
    Title="{Binding Title}"
    x:DataType="vm:RecordsViewModel"
    Shell.BackgroundColor="Gray">

    <RefreshView Command="{Binding RefreshCommand}" IsRefreshing="{Binding IsLoading}">
        <ScrollView>
            <Grid Padding="10" RowDefinitions="Auto,*">
                <!--  Header  -->
                <StackLayout Grid.Row="0" Padding="10,0">

                    <!--  Records count  -->
                    <Label
                        Margin="0,0,0,20"
                        FontSize="16"
                        HorizontalOptions="Center"
                        Text="{Binding RecordsCount, StringFormat='Total Records: {0}'}" />
                </StackLayout>

                <!--  Records Table  -->
                <Grid Grid.Row="1" IsVisible="{Binding HasRecords}">
                    <CollectionView BackgroundColor="Transparent" ItemsSource="{Binding Records}">
                        <CollectionView.Header>
                            <!--  Table Header  -->
                            <Grid Padding="10,5" BackgroundColor="LightGray">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*" />
                                    <ColumnDefinition Width="2*" />
                                    <ColumnDefinition Width="2*" />
                                    <ColumnDefinition Width="60" />
                                </Grid.ColumnDefinitions>

                                <Label
                                    Grid.Column="0"
                                    FontAttributes="Bold"
                                    Text="Code"
                                    VerticalOptions="Center" />
                                <Label
                                    Grid.Column="1"
                                    FontAttributes="Bold"
                                    Text="Name"
                                    VerticalOptions="Center" />
                                <Label
                                    Grid.Column="2"
                                    FontAttributes="Bold"
                                    Text="Date"
                                    VerticalOptions="Center" />
                                <Label
                                    Grid.Column="3"
                                    FontAttributes="Bold"
                                    HorizontalTextAlignment="Center"
                                    IsVisible="False"
                                    Text="Action"
                                    VerticalOptions="Center" />
                            </Grid>
                        </CollectionView.Header>

                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="local:QrCodeRecordDisplay">
                                <Grid Padding="10,8" BackgroundColor="White">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="2*" />
                                        <ColumnDefinition Width="2*" />
                                        <ColumnDefinition Width="2*" />
                                        <ColumnDefinition Width="60" />
                                    </Grid.ColumnDefinitions>

                                    <!--  Add separator line  -->
                                    <BoxView
                                        Grid.ColumnSpan="4"
                                        BackgroundColor="LightGray"
                                        HeightRequest="1"
                                        HorizontalOptions="FillAndExpand"
                                        VerticalOptions="Start" />

                                    <Label
                                        Grid.Column="0"
                                        FontSize="14"
                                        LineBreakMode="TailTruncation"
                                        Text="{Binding Code}"
                                        VerticalOptions="Center" />

                                    <Label
                                        Grid.Column="1"
                                        FontSize="14"
                                        LineBreakMode="TailTruncation"
                                        Text="{Binding Name}"
                                        VerticalOptions="Center" />

                                    <Label
                                        Grid.Column="2"
                                        FontSize="12"
                                        Text="{Binding Date, StringFormat='{0:dd/MM HH:mm}'}"
                                        VerticalOptions="Center" />

                                    <Button
                                        Grid.Column="3"
                                        Padding="0"
                                        BackgroundColor="Red"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:RecordsViewModel}}, Path=DeleteRecordCommand}"
                                        CommandParameter="{Binding .}"
                                        CornerRadius="15"
                                        FontSize="16"
                                        HeightRequest="30"
                                        HorizontalOptions="Center"
                                        IsVisible="False"
                                        Text="ðŸ—‘ï¸"
                                        TextColor="White"
                                        VerticalOptions="Center"
                                        WidthRequest="30" />
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </Grid>

                <!--  No Records Message  -->
                <StackLayout
                    Grid.Row="1"
                    HorizontalOptions="CenterAndExpand"
                    IsVisible="{Binding HasNoRecords}"
                    VerticalOptions="CenterAndExpand">

                    <Label
                        FontSize="18"
                        HorizontalOptions="Center"
                        Text="No records found"
                        TextColor="Gray" />

                    <Label
                        Margin="0,10,0,0"
                        FontSize="14"
                        HorizontalOptions="Center"
                        Text="Scan some QR codes to see them here!"
                        TextColor="Gray" />
                </StackLayout>

                <!--  Loading Indicator  -->
                <ActivityIndicator
                    Grid.Row="1"
                    HorizontalOptions="CenterAndExpand"
                    IsRunning="{Binding IsLoading}"
                    IsVisible="{Binding IsLoading}"
                    VerticalOptions="CenterAndExpand"
                    Color="Blue" />
            </Grid>
        </ScrollView>
    </RefreshView>
</ContentPage>